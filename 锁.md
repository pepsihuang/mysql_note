


## 全局锁

对整个数据库加锁.

可使用加全局读锁的方法:(**FTWRL**)
```
Flush tables with read lock
```

被阻塞的操作:

1. 数据更新语句(增删改DML)
2. 数据定义语句(改表建表DDL)

使用场景: 全库逻辑备份.

加全局读锁的弊端:

1. 在主库备份,整个期间业务不可用.
2. 在从库备份,整个期间从库不能执行主库同步过来的binlog.

不加锁的弊端,必然是会导致逻辑不一致.

别使用``set global readonly=true``命令让全库只读,因为:

1. readonly可能会被当作其他逻辑.
2. 当客户端异常时,`FTWRL`则会自动释放全局锁,而readonly会一直保持只读.

## 表级锁

1. 表锁
2. 元数据锁(meta data lock)

### 表锁

```
加锁
lock tables ... read/write
解锁
unlock tables
```

表锁除了会限制别的线程读写外,也会限定本线程的操作.

e.g
```
线程A lock tables t1 read, t2 write;
此时其他线程写t1,读t2会被阻塞;
线程A也不能写t1,也不能访问其他表;
```

### MDL

不需要显式加锁;
当访问一个表时被自动加上.

作用: 保证读写的正确性.


## 行锁





---

## tips

主从库同步